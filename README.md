# KaliLaska

Simple 2D Game Engine based on Sdl and OpenGL ES 3

Use:
  - Sdl
  - OpenGL ES 3
  - imgui
  - tinyxml
  - Tiled (for created tile maps)
  - miniz
  - base64
  - Catch2 (for testing)
  - Box2D (as physical engin)
  - gl3w
  - picopng

cxx_std_17

Движок предназначен для создания простых 2D игр, таких как mario, bomberman и
др. В движке реализована поддержка тайловой графики, посредствам использования 
Tiled. Для описания объектов, состояний и т.д. используется xml файлы, что
обеспечит гибкость (так как ненужно перекомпилировать всю программу, а лишь
изменть загружаемый xml файл).

--------------------------------------------------------------------------------

Director - главный, управляющий класс, по сути являющийся синглтоном (можно создать не более 
одного экземпляра в переделах фигурных скобок!). Создание экземпляра будет 
происходит в main файле с возможностью указания определенных параметров. Доступ
к экземпляру в других частях программы будет осуществляться посредствам статической
функции Director::instance(), которая будет возвращать указатель на созданный
экземпляр, либо nullptr, если создания еще не было.

Director содержит в себе сервисы:
  - EventProvider поставщик ивентов
  - TextureManager текстурный менеджер
  - SoundPlayer проигрыватель

Также сам движок компилиться в executable, который содержит main, где создается
Director и загружаются все динамические библиотеки из определенной директории.
Если библиотека имеет функцию (с определенным названием, export C) которая 
возвращает указатель, на объект класса AbstractGame, то этот объект добавляется
в меню, которое отображается при запуске и показывает все игры, возможные для
запуска. Если таких нет выдается предупреждение и кнопка для выхода.

--------------------------------------------------------------------------------

Drawable - базовый класс для Light, Sprite и Tile. Разделение на два вида базовых 
объектов позволит оптимизировать работу OpenGL (непередавать каждый раз данные 
для статичных объектов). Также имеет указатель на объект Scene, которому
принадлежит (может принадлежать не более, чем одной сцене). Имеет глубину.
Каждый унаследованный класс должен возвращать свой тип (enum {Tile, Sprite, 
PointLight, DirectLight}). Для объекта можно установить анимацию.

--------------------------------------------------------------------------------

Sprite - абстрактный класс для создания ПОДВИЖНЫХ объектов, унаследованный от 
Drawable. Используйте этот класс, если ваши объекты должны перемещаться в
пространстве (двумерном).

--------------------------------------------------------------------------------

Tile - абстрактный класс для создания СТАТИЧНЫХ (неподвижных) объектов,унаследованный
от Drawable. Данные объекты не могут перемещаться, но им можно назначить анимацию.
Объект имеет свойство проницаемости, которое нужно для создания динамического освещения.
Проницаемость может быть установлена в два взаимоисключающих состояния: проницаемый
(объект не перегораживает свет) и непроницаемый (объект будет отбрасывать тень).

--------------------------------------------------------------------------------

Light - абстрактный класс для создания света, унаследованный от Drawable.
Свет является динамическим.

--------------------------------------------------------------------------------

PointLight - класс представляющий точечный свет, унаследованный от Light.

--------------------------------------------------------------------------------

SpotLight - класс, представляющий направленный свет от местного источника (представляется как конус)
, унаследованный от Light.

--------------------------------------------------------------------------------

DirectLight - класс, представляющий свет, от некоего далекого источника,
лучи от которого паралельны (например солнце). Устанавливается для всей сцены в целом.
Влияет на освещенность, но непроницаемые объекты не будут отбрасывать тень, так
как невозможно для 2D предусмотреть какая будет тень (несмотря на то, что имеем угол
мы имеем дело с двумерными объектами, которые не известно как располагаются в 
псевдотрехмерном пространстве). Тени в данном случае могут быть реализованы
в ручную, с помощью классы Shadow. Таким образом можно точно установить тень.

Для инициализации потребуется цвет и углы возвышения (по оси E-W & N-S). При этом
углы в пределах 0-180 будут давать свет (солнце над горизонтом) в разном количетве:
максимальное для (90,90). При этом важно обеспечить адекватность освещения. Так 
при углах (45,45) свет не должен быть только половиной, от точно, что в зените.
Думаю следует ограничить возвышения, в которые начинаются сумерки, а в этих
пределах свет должен быть максимальным. Думаю сам пользователь должен мочь 
установить сумерки и максимум освещения для "тьмы".

--------------------------------------------------------------------------------

Shadow - класс, представляющий собой тень. Нужен для поддержки динамического 
освещения и создания теней от DirectionLight.

--------------------------------------------------------------------------------

Освещение. Для освещения используется отдельная текстура, в которую рисуется
весь свет. После этого световая карта накладывается на рисованные объекты.
При этом движок должен обеспечить создание текстуры для света (и ее последующее
применение) только в случае, если до этого была определена соответствующая 
переменная (например enableLight), после чего обязательно, должен быть установлен
DirectLight для всей сцены. При этом DirectLight, по сути, предоставляет значение
для очистки буфера (clear_color). Также первыми должны быть обработаны Shadow, 
находящиеся в сцене, так как их предназначение - создание теней от "солнца".
После, должны быть обработаны все PointLight & SpotLight, которые должны получить
колижены от всех объектов со свойством непроницаемости, и расчитать тени от этих
объектов.

--------------------------------------------------------------------------------

Scene - класс, который реализует сцену. По сути представляет собой контейнер,
содержащий объекты, унаследованные от Drawable. Добавление в сцену объекта
происходит по средствам метода add_item, который помимо добавления объекта, 
выставляет ему указатель на саму себя (объект может принадлежать только одной
сцене). При этом поступающие на вход объекты сортируются по принадлежности
(свет, спрайты, тайлы и т.д.) и по глубине. Объекты же рисуются согласно этой
сортировке (начиная с самых глубоких).

--------------------------------------------------------------------------------

StateMachine - класс, представляющий собой машину состояний для сцен. Имеет
по крайней мере 4 состояния: menu, on_game, pause, over - каждое из которых 
представлено сценой. При этом можно обрабатывать одну или несколько сцен
одновременно с указанием порядка (например сначала рисовать on_game, а после нее
(поверх) on_pause). Состояния загружаются либо при инициализации, либо близко к
ней. Также, для управления переходами состояний в нее передается матрица с
функциями перехода от одного состояния к другому (при инициализации, либо близко
к ней).

--------------------------------------------------------------------------------

AbstractGame - абстрактный класс для создания игры. Содержит, либо унаследован
от StateMachine. Объект этого класса может быть загружен Director, для чего
в хэдэре, унаследованного класса, должен быть проставлен макрос (за пределами
классов и нэймспэсов) который реализует функцию, которая возвращает указатель,
на инстанцированный объект этого класса.

--------------------------------------------------------------------------------

EventProvider - класс, который переводит sdl евенты в ивенты, определенные в
движке и отсылает всем, кто их принимает.

--------------------------------------------------------------------------------

Нужно подыскать единицы измерения.
